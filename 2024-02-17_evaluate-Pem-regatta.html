<!DOCTYPE html>
<html>
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WVT0XLX8QY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WVT0XLX8QY');
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pembroke regatta predictions | Bumps predictions</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
      <script src="libs/header-attrs-2.25/header-attrs.js"></script>
      <script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
      <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
      <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
      <script src="libs/datatables-binding-0.31/datatables.js"></script>
      <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
      <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
      <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
      <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
      <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
      <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
  </head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Bumps Prediction</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/">Overall</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/crews.html">Crew-by-crew</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/ranking.html">Crew rankings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/gor.html">Getting-On Race</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/events.html">Event adjustments</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about.html">How the model works</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://bumpsprediction.substack.com/">Blog</a>
        </li>
      </ul>
    </div>
  </div> 
</nav>
<div class="container">
  <div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(downloadthis)</span>
  <span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
  <span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
  <span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">library</span>(tidyr)</span>
  <span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>events =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;M1&quot;</span>, <span class="st">&quot;M2&quot;</span>, <span class="st">&quot;W1&quot;</span>, <span class="st">&quot;W2&quot;</span>)</span></code></pre></div>
  <div id="setup" class="section level1">
  <h1>Setup</h1>
  <div id="calculate-the-conditional-probabilities" class="section level2">
  <h2>Calculate the conditional probabilities</h2>
  <div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>tbl_predictions =<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_dfr</span>(</span>
  <span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    events,</span>
  <span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>    <span class="co"># read in the predictions for each event</span></span>
  <span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>    <span class="op">~</span>readr<span class="op">::</span><span class="kw">read_csv</span>(</span>
  <span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>        here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;analyses&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;2024-02-16_Pem-&quot;</span>, .x, <span class="st">&quot;.csv&quot;</span>)),</span>
  <span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>        <span class="dt">col_types =</span> readr<span class="op">::</span><span class="kw">cols</span>(</span>
  <span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>            <span class="dt">Competitor =</span> readr<span class="op">::</span><span class="kw">col_character</span>(),</span>
  <span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>            <span class="dt">.default =</span> readr<span class="op">::</span><span class="kw">col_double</span>()</span>
  <span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>        ),</span>
  <span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>    ) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">crew_name =</span> Competitor) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="st">    </span><span class="co"># pivot to long format for easier manipulation</span></span>
  <span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">pivot_longer</span>(</span>
  <span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>        <span class="dt">cols =</span> <span class="op">!</span><span class="kw">c</span>(crew_name),</span>
  <span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>        <span class="dt">names_to =</span> <span class="st">&quot;round&quot;</span>,</span>
  <span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>        <span class="dt">values_to =</span> <span class="st">&quot;prob&quot;</span></span>
  <span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>    ),</span>
  <span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a>    <span class="dt">.id =</span> <span class="st">&quot;event&quot;</span></span>
  <span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">round =</span> <span class="kw">as.integer</span>(round)) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a><span class="st">    </span><span class="co"># remove mistakes in output and byes</span></span>
  <span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(round <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>, prob <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
  <div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>tbl_cond_probs =<span class="st"> </span>tbl_predictions <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="st">    </span><span class="co"># calculate the conditional probability</span></span>
  <span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="st">    </span><span class="co"># p(win round A | compete in round A) = p(win round A) / p(compete in round A)</span></span>
  <span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="st">    </span><span class="co"># NB: p(compete in round A) = 1 for the first round</span></span>
  <span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">group_by</span>(crew_name) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">arrange</span>(round, <span class="dt">.by_group =</span> <span class="ot">TRUE</span>) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
  <span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>        <span class="co"># probability 0 breaks things, make it up to</span></span>
  <span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>        <span class="co"># Monte Carlo error</span></span>
  <span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>        <span class="dt">prob =</span> <span class="kw">pmax</span>(prob, <span class="dv">1</span><span class="op">/</span><span class="dv">1000</span>),</span>
  <span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>        <span class="dt">cond_prob =</span> prob <span class="op">/</span><span class="st"> </span><span class="kw">c</span>(<span class="kw">lead</span>(prob)[<span class="op">-</span><span class="kw">n</span>()], <span class="dv">1</span>),</span>
  <span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>    ) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="st">    </span>assertr<span class="op">::</span><span class="kw">assert</span>(assertr<span class="op">::</span>not_na, cond_prob)</span>
  <span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a></span>
  <span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>tbl_cond_probs <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="st">    </span>DT<span class="op">::</span><span class="kw">datatable</span>()</span></code></pre></div>
  <div class="datatables html-widget html-fill-item" id="htmlwidget-e7abc30786c382604f66" style="width:100%;height:auto;"></div>
  <script type="application/json" data-for="htmlwidget-e7abc30786c382604f66">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201"],["4","4","4","4","1","1","1","1","1","1","1","1","3","3","3","3","4","4","4","4","4","4","4","4","1","1","1","1","1","1","1","1","2","2","2","2","3","3","3","3","4","4","4","4","2","2","2","4","4","4","4","1","1","1","2","2","2","2","3","3","3","3","4","4","4","4","4","4","4","2","2","2","2","1","1","1","1","3","3","3","2","2","2","2","3","3","3","3","3","3","3","3","4","4","4","2","2","2","2","4","4","4","4","1","1","1","1","1","1","1","1","2","2","2","2","3","3","3","3","4","4","4","4","2","2","2","2","3","3","3","3","3","3","3","3","3","3","3","3","4","4","4","4","1","1","1","1","3","3","3","3","1","1","1","2","2","2","2","1","1","1","1","1","1","1","1","3","3","3","3","2","2","2","3","3","3","1","1","1","3","3","3","3","4","4","4","4","2","2","2","4","4","4","4","2","2","2","4","4","4","4"],["Anglia Ruskin W1","Anglia Ruskin W1","Anglia Ruskin W1","Anglia Ruskin W1","Caius M1","Caius M1","Caius M1","Caius M1","Caius M2","Caius M2","Caius M2","Caius M2","Caius W1","Caius W1","Caius W1","Caius W1","Caius W2","Caius W2","Caius W2","Caius W2","Christ's W2","Christ's W2","Christ's W2","Christ's W2","Churchill M1","Churchill M1","Churchill M1","Churchill M1","Clare M1","Clare M1","Clare M1","Clare M1","Clare M2","Clare M2","Clare M2","Clare M2","Clare W1","Clare W1","Clare W1","Clare W1","Clare W2","Clare W2","Clare W2","Clare W2","Corpus M1","Corpus M1","Corpus M1","Corpus W1","Corpus W1","Corpus W1","Corpus W1","Emmanuel M1","Emmanuel M1","Emmanuel M1","Emmanuel M2","Emmanuel M2","Emmanuel M2","Emmanuel M2","Emmanuel W1","Emmanuel W1","Emmanuel W1","Emmanuel W1","Emmanuel W2","Emmanuel W2","Emmanuel W2","Emmanuel W2","Emmanuel W3","Emmanuel W3","Emmanuel W3","First and Third M2","First and Third M2","First and Third M2","First and Third M2","Fitzwilliam M1","Fitzwilliam M1","Fitzwilliam M1","Fitzwilliam M1","Fitzwilliam W1","Fitzwilliam W1","Fitzwilliam W1","Girton M1","Girton M1","Girton M1","Girton M1","Girton W1","Girton W1","Girton W1","Girton W1","Homerton W1","Homerton W1","Homerton W1","Homerton W1","Hughes W1","Hughes W1","Hughes W1","Jesus M2","Jesus M2","Jesus M2","Jesus M2","Jesus W2","Jesus W2","Jesus W2","Jesus W2","Lady Margaret M1","Lady Margaret M1","Lady Margaret M1","Lady Margaret M1","Lady Margaret M2","Lady Margaret M2","Lady Margaret M2","Lady Margaret M2","Lady Margaret M3","Lady Margaret M3","Lady Margaret M3","Lady Margaret M3","Lady Margaret W1","Lady Margaret W1","Lady Margaret W1","Lady Margaret W1","Lady Margaret W2","Lady Margaret W2","Lady Margaret W2","Lady Margaret W2","Magdalene M2","Magdalene M2","Magdalene M2","Magdalene M2","Magdalene W1","Magdalene W1","Magdalene W1","Magdalene W1","Medwards W1","Medwards W1","Medwards W1","Medwards W1","Newnham W1","Newnham W1","Newnham W1","Newnham W1","Newnham W2","Newnham W2","Newnham W2","Newnham W2","Peterhouse M1","Peterhouse M1","Peterhouse M1","Peterhouse M1","Peterhouse W1","Peterhouse W1","Peterhouse W1","Peterhouse W1","Queens' M1","Queens' M1","Queens' M1","Queens' M2","Queens' M2","Queens' M2","Queens' M2","Robinson M1","Robinson M1","Robinson M1","Robinson M1","Selwyn M1","Selwyn M1","Selwyn M1","Selwyn M1","Selwyn W1","Selwyn W1","Selwyn W1","Selwyn W1","Sidney M1","Sidney M1","Sidney M1","Sidney W1","Sidney W1","Sidney W1","St. Catherine's M1","St. Catherine's M1","St. Catherine's M1","St. Catherine's W1","St. Catherine's W1","St. Catherine's W1","St. Catherine's W1","St. Catherine's W2","St. Catherine's W2","St. Catherine's W2","St. Catherine's W2","St. Edmund's M1","St. Edmund's M1","St. Edmund's M1","St. Edmund's W1","St. Edmund's W1","St. Edmund's W1","St. Edmund's W1","Wolfson M1","Wolfson M1","Wolfson M1","Wolfson W1","Wolfson W1","Wolfson W1","Wolfson W1"],[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,0,1,2,3,0,1,2,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,0,1,2,3,0,1,2,3,0,1,2,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,0,1,2,0,1,2,0,1,2,3,0,1,2,3,0,1,2,0,1,2,3,0,1,2,0,1,2,3],[0.017,0.033,0.05,0.184,0.008999999999999999,0.033,0.702,0.979,0.001,0.001,0.001,0.056,0.143,0.249,0.572,0.6929999999999999,0.028,0.126,0.659,0.802,0.001,0.003,0.004,0.037,0.001,0.001,0.003,0.021,0.004,0.017,0.024,0.03,0.001,0.001,0.01,0.39,0.334,0.737,0.9,0.918,0.001,0.003,0.043,0.321,0.38,0.52,0.78,0.019,0.058,0.121,0.247,0.125,0.541,0.955,0.05,0.09,0.22,0.96,0.182,0.278,0.436,0.878,0.334,0.591,0.661,0.963,0.001,0.014,0.238,0.01,0.02,0.09,0.61,0.006,0.047,0.14,0.238,0.001,0.006,0.03,0.01,0.07000000000000001,0.12,0.67,0.001,0.004,0.014,0.217,0.023,0.055,0.225,0.307,0.109,0.26,0.335,0.19,0.45,0.53,0.63,0.188,0.353,0.49,0.753,0.773,0.931,0.961,0.97,0.001,0.005,0.02,0.523,0.001,0.001,0.001,0.05,0.015,0.043,0.189,0.783,0.002,0.013,0.131,0.679,0.07000000000000001,0.2,0.28,0.37,0.006,0.035,0.07000000000000001,0.082,0.011,0.022,0.044,0.153,0.226,0.337,0.497,0.847,0.159,0.271,0.591,0.6830000000000001,0.002,0.058,0.223,0.944,0.005,0.012,0.023,0.122,0.003,0.008,0.015,0.02,0.06,0.07000000000000001,0.33,0.001,0.007,0.025,0.477,0.075,0.342,0.637,0.762,0.013,0.065,0.272,0.37,0.03,0.22,0.86,0.001,0.022,0.225,0.003,0.011,0.295,0.041,0.135,0.503,0.63,0.001,0.006,0.103,0.198,0.001,0.01,0.14,0.008999999999999999,0.044,0.235,0.317,0.23,0.36,0.9,0.133,0.225,0.339,0.8159999999999999],[0.5151515151515151,0.66,0.2717391304347826,0.184,0.2727272727272727,0.04700854700854702,0.7170582226762002,0.979,1,1,0.01785714285714286,0.056,0.57429718875502,0.4353146853146854,0.8253968253968254,0.6929999999999999,0.2222222222222222,0.1911987860394537,0.8216957605985037,0.802,0.3333333333333333,0.75,0.1081081081081081,0.037,1,0.3333333333333333,0.1428571428571428,0.021,0.2352941176470588,0.7083333333333334,0.8,0.03,1,0.1,0.02564102564102564,0.39,0.4531886024423338,0.8188888888888889,0.9803921568627451,0.918,0.3333333333333333,0.06976744186046513,0.1339563862928349,0.321,0.7307692307692307,0.6666666666666666,0.78,0.3275862068965517,0.4793388429752066,0.4898785425101215,0.247,0.2310536044362292,0.5664921465968586,0.955,0.5555555555555556,0.4090909090909091,0.2291666666666667,0.96,0.6546762589928057,0.6376146788990826,0.4965831435079727,0.878,0.5651438240270729,0.8940998487140696,0.6863966770508827,0.963,0.07142857142857142,0.05882352941176471,0.238,0.5,0.2222222222222222,0.1475409836065574,0.61,0.1276595744680851,0.3357142857142857,0.5882352941176472,0.238,0.1666666666666667,0.2,0.03,0.1428571428571428,0.5833333333333334,0.1791044776119403,0.67,0.25,0.2857142857142857,0.06451612903225806,0.217,0.4181818181818182,0.2444444444444444,0.7328990228013029,0.307,0.4192307692307692,0.7761194029850746,0.335,0.4222222222222222,0.8490566037735849,0.8412698412698413,0.63,0.5325779036827196,0.7204081632653061,0.650730411686587,0.753,0.8302900107411385,0.9687825182101978,0.9907216494845361,0.97,0.2,0.25,0.03824091778202677,0.523,1,1,0.02,0.05,0.3488372093023256,0.2275132275132275,0.2413793103448276,0.783,0.1538461538461539,0.09923664122137403,0.1929307805596465,0.679,0.35,0.7142857142857143,0.7567567567567568,0.37,0.1714285714285714,0.5,0.8536585365853659,0.082,0.5,0.5,0.2875816993464052,0.153,0.6706231454005934,0.6780684104627767,0.5867768595041323,0.847,0.5867158671586715,0.4585448392554992,0.8653001464128842,0.6830000000000001,0.03448275862068965,0.2600896860986547,0.236228813559322,0.944,0.4166666666666667,0.5217391304347826,0.1885245901639344,0.122,0.375,0.5333333333333333,0.015,0.3333333333333334,0.857142857142857,0.2121212121212121,0.33,0.1428571428571428,0.28,0.05241090146750525,0.477,0.2192982456140351,0.5368916797488227,0.8359580052493438,0.762,0.2,0.2389705882352941,0.7351351351351352,0.37,0.1363636363636364,0.2558139534883721,0.86,0.04545454545454546,0.09777777777777777,0.225,0.2727272727272728,0.03728813559322034,0.295,0.3037037037037037,0.268389662027833,0.7984126984126985,0.63,0.1666666666666667,0.05825242718446602,0.5202020202020201,0.198,0.1,0.07142857142857142,0.14,0.2045454545454545,0.1872340425531915,0.7413249211356466,0.317,0.638888888888889,0.4,0.9,0.5911111111111111,0.663716814159292,0.4154411764705883,0.8159999999999999]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>event<\/th>\n      <th>crew_name<\/th>\n      <th>round<\/th>\n      <th>prob<\/th>\n      <th>cond_prob<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"event","targets":1},{"name":"crew_name","targets":2},{"name":"round","targets":3},{"name":"prob","targets":4},{"name":"cond_prob","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
  </div>
  <div id="read-the-results" class="section level2">
  <h2>Read the results</h2>
  <div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="co"># results contain the round each crew lost, or 0 if they won the event</span></span>
  <span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>tbl_results =<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(</span>
  <span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data/results/pem_regatta.csv&quot;</span>),</span>
  <span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="dt">col_types =</span> readr<span class="op">::</span><span class="kw">cols</span>(</span>
  <span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>        <span class="dt">crew_name =</span> readr<span class="op">::</span><span class="kw">col_character</span>(),</span>
  <span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>        <span class="dt">round =</span> readr<span class="op">::</span><span class="kw">col_integer</span>(),</span>
  <span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>    )</span>
  <span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">last_round =</span> round)</span>
  <span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a></span>
  <span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>tbl_results <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a><span class="st">    </span>DT<span class="op">::</span><span class="kw">datatable</span>()</span></code></pre></div>
  <div class="datatables html-widget html-fill-item" id="htmlwidget-23dc247295b2d96f7b03" style="width:100%;height:auto;"></div>
  <script type="application/json" data-for="htmlwidget-23dc247295b2d96f7b03">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52"],["Lady Margaret M1","Emmanuel M1","Selwyn M1","Caius M1","Fitzwilliam M1","Clare M1","Queens' M1","St. Catherine's M1","Peterhouse M1","Lady Margaret M2","Robinson M1","Churchill M1","Caius M2","Corpus M1","Wolfson M1","Jesus M2","Magdalene M2","Emmanuel M2","Sidney M1","Queens' M2","First and Third M2","Girton M1","St. Edmund's M1","Clare M2","Lady Margaret M3","Clare W1","Newnham W1","Emmanuel W1","Caius W1","St. Catherine's W1","Homerton W1","Selwyn W1","Medwards W1","Magdalene W1","Peterhouse W1","Sidney W1","Fitzwilliam W1","Girton W1","Emmanuel W2","Jesus W2","Newnham W2","Wolfson W1","Hughes W1","Caius W2","Corpus W1","Anglia Ruskin W1","St. Edmund's W1","Lady Margaret W2","Emmanuel W3","St. Catherine's W2","Christ's W2","Clare W2"],[0,1,2,2,4,4,3,3,3,3,4,4,4,2,1,0,4,3,2,4,3,3,3,4,4,2,3,2,1,0,4,4,4,4,4,3,3,3,3,4,2,0,1,2,3,4,4,4,3,4,4,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>crew_name<\/th>\n      <th>last_round<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"crew_name","targets":1},{"name":"last_round","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
  </div>
  <div id="join-tables" class="section level2">
  <h2>Join tables</h2>
  <div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>tbl_probs_outcomes =<span class="st"> </span><span class="kw">left_join</span>(</span>
  <span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    tbl_cond_probs,</span>
  <span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    tbl_results,</span>
  <span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    <span class="dt">by =</span> <span class="st">&quot;crew_name&quot;</span></span>
  <span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(</span>
  <span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>        round <span class="op">&gt;=</span><span class="st"> </span>last_round <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</span>
  <span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>        <span class="co"># exclude match-ups due to LMBC scratching</span></span>
  <span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>        crew_name <span class="op">!=</span><span class="st"> &quot;Girton W1&quot;</span>,</span>
  <span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>        <span class="op">!</span>(crew_name <span class="op">==</span><span class="st"> &quot;Caius W1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>round <span class="op">==</span><span class="st"> </span><span class="dv">3</span>),</span>
  <span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    ) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a><span class="st">    </span><span class="co"># set outcome to 1 if the crew progressed past the round,</span></span>
  <span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a><span class="st">    </span><span class="co"># 0 if they didn&#39;t</span></span>
  <span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
  <span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>        <span class="dt">outcome =</span> (round <span class="op">&gt;=</span><span class="st"> </span>last_round),</span>
  <span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>        <span class="dt">brier =</span> (cond_prob <span class="op">-</span><span class="st"> </span>outcome)<span class="op">^</span><span class="dv">2</span></span>
  <span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>    )</span></code></pre></div>
  <p>Should be a true and false pair for each race, hence overall 50% of outcomes are true:</p>
  <div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>tbl_probs_outcomes <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarise</span>(</span>
  <span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>        <span class="kw">mean</span>(outcome),</span>
  <span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>        <span class="dt">.by =</span> event</span>
  <span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>    )</span></code></pre></div>
  <pre><code>## # A tibble: 4 Ã— 2
  ##   event `mean(outcome)`
  ##   &lt;chr&gt;           &lt;dbl&gt;
  ## 1 4                 0.5
  ## 2 1                 0.5
  ## 3 3                 0.5
  ## 4 2                 0.5</code></pre>
  </div>
  </div>
  <div id="calibration" class="section level1">
  <h1>Calibration</h1>
  <div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>tbl_probs_outcomes <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="st">    </span><span class="co"># bin into five equal size bins based on the conditional probability</span></span>
  <span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="st">    </span><span class="co"># then check the calibration of the bins</span></span>
  <span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">bin =</span> <span class="kw">ntile</span>(cond_prob, <span class="dv">5</span>)) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">summarise</span>(</span>
  <span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>        <span class="dt">.by =</span> bin,</span>
  <span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>        <span class="dt">x =</span> <span class="kw">sum</span>(outcome),</span>
  <span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        <span class="dt">n =</span> <span class="kw">n</span>(),</span>
  <span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>        <span class="dt">mean_pred =</span> <span class="kw">mean</span>(cond_prob),</span>
  <span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>    ) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a><span class="st">    </span><span class="co"># exact 80% confidence intervals for binomial proportions</span></span>
  <span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
  <span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>        binom<span class="op">::</span><span class="kw">binom.confint</span>(</span>
  <span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>            x, n,</span>
  <span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>            <span class="dt">conf.level =</span> <span class="fl">0.8</span>,</span>
  <span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a>            <span class="dt">methods =</span> <span class="st">&quot;exact&quot;</span></span>
  <span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>        )</span>
  <span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a>    ) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a><span class="st">    </span><span class="co"># plot with binomial confidence intervals</span></span>
  <span id="cb8-20"><a href="#cb8-20" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean_pred, <span class="dt">y =</span> mean)) <span class="op">+</span></span>
  <span id="cb8-21"><a href="#cb8-21" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
  <span id="cb8-22"><a href="#cb8-22" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_errorbar</span>(</span>
  <span id="cb8-23"><a href="#cb8-23" aria-hidden="true"></a>        <span class="kw">aes</span>(<span class="dt">ymin =</span> lower,</span>
  <span id="cb8-24"><a href="#cb8-24" aria-hidden="true"></a>            <span class="dt">ymax =</span> upper),</span>
  <span id="cb8-25"><a href="#cb8-25" aria-hidden="true"></a>        <span class="dt">width =</span> <span class="dv">0</span></span>
  <span id="cb8-26"><a href="#cb8-26" aria-hidden="true"></a>    ) <span class="op">+</span></span>
  <span id="cb8-27"><a href="#cb8-27" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
  <span id="cb8-28"><a href="#cb8-28" aria-hidden="true"></a><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
  <span id="cb8-29"><a href="#cb8-29" aria-hidden="true"></a><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
  <span id="cb8-30"><a href="#cb8-30" aria-hidden="true"></a><span class="st">    </span><span class="kw">labs</span>(</span>
  <span id="cb8-31"><a href="#cb8-31" aria-hidden="true"></a>        <span class="dt">x =</span> <span class="st">&quot;Predicted probability&quot;</span>,</span>
  <span id="cb8-32"><a href="#cb8-32" aria-hidden="true"></a>        <span class="dt">y =</span> <span class="st">&quot;Observed probability&quot;</span>,</span>
  <span id="cb8-33"><a href="#cb8-33" aria-hidden="true"></a>        <span class="dt">title =</span> <span class="st">&quot;Calibration of predicted probabilities&quot;</span>,</span>
  <span id="cb8-34"><a href="#cb8-34" aria-hidden="true"></a>        <span class="dt">subtitle =</span> <span class="st">&quot;Points are the mean observed probability in each bin, with 80% confidence intervals&quot;</span></span>
  <span id="cb8-35"><a href="#cb8-35" aria-hidden="true"></a>    ) <span class="op">+</span></span>
  <span id="cb8-36"><a href="#cb8-36" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
  <p><img src="2024-02-17_evaluate-Pem-regatta_files/figure-html/calibration-1.png" width="672" /></p>
  </div>
  <div id="surprising-results" class="section level1">
  <h1>Surprising results</h1>
  <p>Mean brier score is 0.1357385 with a standard deviation of 0.1683743.</p>
  <div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>tbl_probs_outcomes <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(brier)) <span class="op">+</span></span>
  <span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>) <span class="op">+</span></span>
  <span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">labs</span>(</span>
  <span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>        <span class="dt">x =</span> <span class="st">&quot;Brier score&quot;</span>,</span>
  <span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>        <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
  <span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>        <span class="dt">title =</span> <span class="st">&quot;Distribution of Brier scores&quot;</span></span>
  <span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>    ) <span class="op">+</span></span>
  <span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
  <p><img src="2024-02-17_evaluate-Pem-regatta_files/figure-html/brier-1.png" width="672" /></p>
  <p>The table below shows the most surprising results, based on the brier score.</p>
  <div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>tbl_probs_outcomes <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="st">    </span><span class="co"># calculate the log odds of the conditional probability</span></span>
  <span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(brier)) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="st">    </span>DT<span class="op">::</span><span class="kw">datatable</span>()</span></code></pre></div>
  <div class="datatables html-widget html-fill-item" id="htmlwidget-98d676a77399bc2fca31" style="width:100%;height:auto;"></div>
  <script type="application/json" data-for="htmlwidget-98d676a77399bc2fca31">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94"],["3","4","4","3","3","4","4","4","2","4","2","3","2","3","4","2","3","3","1","3","4","1","1","4","1","4","4","2","2","2","2","3","3","4","2","2","4","4","3","1","1","2","4","1","1","1","1","2","3","4","2","3","4","4","4","4","4","2","4","3","1","1","2","3","3","2","2","2","2","4","4","3","3","2","3","3","1","1","2","1","1","2","1","4","4","1","1","1","3","1","1","3","1","1"],["Clare W1","Corpus W1","Jesus W2","St. Catherine's W1","St. Catherine's W1","Emmanuel W2","Clare W2","Lady Margaret W2","Corpus M1","Hughes W1","Wolfson M1","Emmanuel W1","Wolfson M1","Newnham W1","Wolfson W1","Jesus M2","Caius W1","Caius W1","Selwyn M1","Emmanuel W1","Corpus W1","Lady Margaret M2","Robinson M1","Newnham W2","Emmanuel M1","Hughes W1","Wolfson W1","Clare M2","First and Third M2","Jesus M2","Magdalene M2","Selwyn W1","St. Catherine's W1","Wolfson W1","Queens' M2","Girton M1","St. Edmund's W1","Newnham W2","Homerton W1","St. Catherine's M1","Caius M1","Sidney M1","Emmanuel W3","Fitzwilliam M1","Selwyn M1","Peterhouse M1","Emmanuel M1","Emmanuel M2","Sidney W1","Hughes W1","Corpus M1","St. Catherine's W1","St. Catherine's W2","Caius W2","Caius W2","Wolfson W1","Anglia Ruskin W1","Girton M1","Caius W2","Caius W1","Lady Margaret M1","Selwyn M1","Jesus M2","Newnham W1","Medwards W1","Jesus M2","First and Third M2","Sidney M1","St. Edmund's M1","Newnham W2","Clare W2","Emmanuel W1","Peterhouse W1","Wolfson M1","Magdalene W1","Clare W1","Peterhouse M1","Caius M2","Lady Margaret M3","Caius M1","Emmanuel M1","Emmanuel M2","Lady Margaret M2","Emmanuel W2","Christ's W2","Lady Margaret M1","Lady Margaret M1","Clare M1","Fitzwilliam W1","Caius M1","Churchill M1","Clare W1","Queens' M1","Lady Margaret M1"],[1,3,3,1,0,2,3,3,1,2,0,1,1,2,2,0,0,1,1,2,2,3,3,1,1,0,0,3,3,3,3,3,3,1,3,3,3,3,3,2,2,1,2,3,3,2,0,2,2,1,2,2,3,3,1,3,3,2,2,2,0,2,2,3,3,1,2,2,2,2,2,3,3,2,3,3,3,3,3,1,2,3,2,3,3,1,3,3,2,3,3,2,2,2],[0.737,0.247,0.753,0.135,0.041,0.661,0.321,0.679,0.52,0.335,0.23,0.278,0.36,0.497,0.339,0.19,0.143,0.249,0.342,0.436,0.121,0.523,0.477,0.271,0.541,0.109,0.133,0.39,0.61,0.63,0.37,0.37,0.63,0.225,0.33,0.67,0.317,0.6830000000000001,0.307,0.295,0.702,0.22,0.238,0.238,0.762,0.223,0.125,0.22,0.225,0.26,0.78,0.503,0.198,0.802,0.126,0.8159999999999999,0.184,0.12,0.659,0.572,0.773,0.637,0.53,0.847,0.153,0.45,0.09,0.86,0.14,0.591,0.043,0.878,0.122,0.9,0.082,0.918,0.944,0.056,0.05,0.033,0.955,0.96,0.02,0.963,0.037,0.931,0.97,0.03,0.03,0.979,0.021,0.9,0.015,0.961],[0.8188888888888889,0.247,0.753,0.268389662027833,0.3037037037037037,0.6863966770508827,0.321,0.679,0.6666666666666666,0.335,0.638888888888889,0.6376146788990826,0.4,0.5867768595041323,0.4154411764705883,0.4222222222222222,0.57429718875502,0.4353146853146854,0.5368916797488227,0.4965831435079727,0.4898785425101215,0.523,0.477,0.4585448392554992,0.5664921465968586,0.4192307692307692,0.5911111111111111,0.39,0.61,0.63,0.37,0.37,0.63,0.663716814159292,0.33,0.67,0.317,0.6830000000000001,0.307,0.295,0.7170582226762002,0.2558139534883721,0.238,0.238,0.762,0.236228813559322,0.2310536044362292,0.2291666666666667,0.225,0.7761194029850746,0.78,0.7984126984126985,0.198,0.802,0.1911987860394537,0.8159999999999999,0.184,0.1791044776119403,0.8216957605985037,0.8253968253968254,0.8302900107411385,0.8359580052493438,0.8412698412698413,0.847,0.153,0.8490566037735849,0.1475409836065574,0.86,0.14,0.8653001464128842,0.1339563862928349,0.878,0.122,0.9,0.082,0.918,0.944,0.056,0.05,0.04700854700854702,0.955,0.96,0.03824091778202677,0.963,0.037,0.9687825182101978,0.97,0.03,0.03,0.979,0.021,0.9803921568627451,0.015,0.9907216494845361],[2,3,4,0,0,3,3,4,2,1,1,2,1,3,0,0,1,1,2,2,3,3,4,2,1,1,0,4,3,0,4,4,0,0,4,3,4,2,4,3,2,2,3,4,2,3,1,3,3,1,2,0,4,2,2,0,4,3,2,1,0,2,0,3,4,0,3,2,3,2,3,2,4,1,4,2,3,4,4,2,1,3,3,3,4,0,0,4,3,2,4,2,3,0],[false,true,false,true,true,false,true,false,false,true,false,false,true,false,true,true,false,true,false,true,false,true,false,false,true,false,true,false,true,true,false,false,true,true,false,true,false,true,false,false,true,false,false,false,true,false,false,false,false,true,true,true,false,true,false,true,false,false,true,true,true,true,true,true,false,true,false,true,false,true,false,true,false,true,false,true,true,false,false,false,true,true,false,true,false,true,true,false,false,true,false,true,false,true],[0.670579012345679,0.567009,0.567009,0.5352536866277484,0.4848285322359396,0.4711403982664937,0.4610410000000001,0.4610410000000001,0.4444444444444444,0.442225,0.4081790123456791,0.4065524787475803,0.3600000000000001,0.3443070828495322,0.3417090181660899,0.3338271604938271,0.329817261011919,0.3188695046212527,0.2882526757835124,0.2534285314003145,0.2399809864118409,0.227529,0.227529,0.2102633696078516,0.1879290589621995,0.1757544378698225,0.1671901234567901,0.1521,0.1521,0.1369,0.1369,0.1369,0.1369,0.1130863810791762,0.1089,0.1089,0.100489,0.100489,0.094249,0.08702499999999999,0.08005604935515069,0.06544077879935101,0.05664399999999999,0.05664399999999999,0.05664399999999999,0.05580405235564494,0.05338576812297346,0.05251736111111112,0.050625,0.0501225217197594,0.04839999999999999,0.04063744016124966,0.039204,0.03920399999999998,0.03655697578296079,0.03385600000000002,0.033856,0.03207841390064602,0.03179240178854611,0.03048626858150669,0.02880148045424288,0.02690977604177431,0.02519526329050138,0.02340900000000001,0.023409,0.02278390886436453,0.02176834184359043,0.0196,0.0196,0.01814405055639043,0.0179443134286352,0.014884,0.014884,0.009999999999999995,0.006724000000000001,0.006723999999999994,0.003136000000000006,0.003136,0.0025,0.002209803491854775,0.002025000000000004,0.001600000000000003,0.001462367792811731,0.001369000000000002,0.001369,0.0009745311692966329,0.0009000000000000016,0.0009,0.0009,0.0004410000000000008,0.000441,0.0003844675124951958,0.000225,8.608778828780893e-05]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>event<\/th>\n      <th>crew_name<\/th>\n      <th>round<\/th>\n      <th>prob<\/th>\n      <th>cond_prob<\/th>\n      <th>last_round<\/th>\n      <th>outcome<\/th>\n      <th>brier<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"event","targets":1},{"name":"crew_name","targets":2},{"name":"round","targets":3},{"name":"prob","targets":4},{"name":"cond_prob","targets":5},{"name":"last_round","targets":6},{"name":"outcome","targets":7},{"name":"brier","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
  <p>Top 10 are a bit above the rest on how surprising. These matchups were (with winner bolded, grouped by event).</p>
  <ul>
  <li>Clare W1 v <strong>Catz W1</strong></li>
  <li><strong>Catz W1</strong> v Emma W1</li>
  <li><strong>Corpus W1</strong> v Jesus W2</li>
  <li>Emma W2 v <strong>Hughes W1</strong></li>
  <li><strong>Clare W2</strong> v Maggie W2</li>
  <li><strong>Wolfson M1</strong> v Corpus M1</li>
  </ul>
  <p>Why did we underestimate Catz? Lets compare their race results to Clare and Emma.</p>
  <div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>fit_prev =<span class="st"> </span><span class="kw">readRDS</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;outputs/fit_archive/fit_2024-02-16_1331.rds&quot;</span>))</span>
  <span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>tbl_data =<span class="st"> </span><span class="kw">tar_read</span>(all_data)</span>
  <span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>tbl_adjustment =<span class="st"> </span>fit_prev <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a><span class="st">  </span>tidybayes<span class="op">::</span><span class="kw">spread_draws</span>(<span class="st">`</span><span class="dt">r_event:div</span><span class="st">`</span>[event_div,], <span class="st">`</span><span class="dt">b_releveleventrefEQnewnham_head(.+)</span><span class="st">`</span>, <span class="dt">regex =</span> T) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="st">&quot;b_releveleventrefEQnewnham_headnewnham_head&quot;</span> =<span class="st"> </span><span class="dv">0</span>) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
  <span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    <span class="kw">starts_with</span>(<span class="st">&quot;b_releveleventrefEQnewnham_head&quot;</span>),</span>
  <span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>    <span class="dt">names_prefix =</span> <span class="st">&quot;b_releveleventrefEQnewnham_head&quot;</span>,</span>
  <span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>    <span class="dt">values_to =</span> <span class="st">&quot;event_adjust&quot;</span>,</span>
  <span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>    <span class="dt">names_to =</span> <span class="st">&quot;event_adjust_event&quot;</span></span>
  <span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>  ) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">extract</span>(event_div, <span class="kw">c</span>(<span class="st">&quot;event&quot;</span>, <span class="st">&quot;div&quot;</span>), <span class="st">&quot;^(.+)_([0-9]+)$&quot;</span>) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(event <span class="op">==</span><span class="st"> </span>event_adjust_event) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">replace_na</span>(<span class="kw">list</span>(<span class="dt">event_adjust =</span> <span class="dv">0</span>)) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(event, div) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
  <span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>    <span class="dt">adjust_div =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">r_event:div</span><span class="st">`</span>),</span>
  <span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>    <span class="dt">adjust_all =</span> <span class="kw">mean</span>(<span class="st">`</span><span class="dt">r_event:div</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span>event_adjust)</span>
  <span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a>  )</span></code></pre></div>
  <pre><code>## `summarise()` has grouped output by &#39;event&#39;. You can override using the
  ## `.groups` argument.</code></pre>
  <div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>tbl_data <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">add_crew_name</span>() <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(crew_name <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;St. Catherine&#39;s W1&quot;</span>, <span class="st">&quot;Clare W1&quot;</span>, <span class="st">&quot;Emmanuel W1&quot;</span>)) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(censor <span class="op">==</span><span class="st"> &quot;none&quot;</span>) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">inner_join</span>(tbl_adjustment, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;event&quot;</span>, <span class="st">&quot;div&quot;</span>)) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">div =</span> <span class="kw">as.integer</span>(div)) <span class="op">|</span><span class="er">&gt;</span></span>
  <span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">transmute</span>(</span>
  <span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>    event,</span>
  <span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>    div,</span>
  <span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>    crew_name,</span>
  <span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>    <span class="dt">raw_time =</span> time,</span>
  <span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a>    <span class="dt">raw_split =</span> <span class="dv">500</span> <span class="op">/</span><span class="st"> </span>speed,</span>
  <span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>    <span class="dt">adjust_div_time =</span> distance <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(speed) <span class="op">-</span><span class="st"> </span>adjust_div),</span>
  <span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a>    <span class="dt">adjust_all_split =</span> <span class="dv">500</span> <span class="op">/</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(speed) <span class="op">-</span><span class="st"> </span>adjust_all),</span>
  <span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a>  ) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">arrange</span>(event, adjust_all_split) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(raw_time, raw_split, adjust_div_time, adjust_all_split), display_duration)) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span></span>
  <span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a><span class="st">  </span>DT<span class="op">::</span><span class="kw">datatable</span>()</span></code></pre></div>
  <div class="datatables html-widget html-fill-item" id="htmlwidget-0ab2b2f22befe3008472" style="width:100%;height:auto;"></div>
  <script type="application/json" data-for="htmlwidget-0ab2b2f22befe3008472">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["fairbairns","fairbairns","fairbairns","newnham_head","newnham_head","winter_head_to_head","winter_head_to_head","winter_head_to_head"],[2,2,2,1,5,2,2,4],["St. Catherine's W1","Clare W1","Emmanuel W1","Clare W1","St. Catherine's W1","Clare W1","Emmanuel W1","St. Catherine's W1"],["17:12.0","17:25.4","17:30.7","8:09.0","7:56.0","15:38.0","15:55.8","17:17.7"],["1:60.0","2:01.6","2:02.2","2:02.2","1:59.0","1:57.2","1:59.5","2:09.7"],["17:13.0","17:26.4","17:31.7","8:00.7","8:09.2","15:39.8","15:57.6","17:21.1"],["2:01.9","2:03.5","2:04.1","2:00.2","2:02.3","2:00.9","2:03.2","2:14.0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>event<\/th>\n      <th>div<\/th>\n      <th>crew_name<\/th>\n      <th>raw_time<\/th>\n      <th>raw_split<\/th>\n      <th>adjust_div_time<\/th>\n      <th>adjust_all_split<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"event","targets":1},{"name":"div","targets":2},{"name":"crew_name","targets":3},{"name":"raw_time","targets":4},{"name":"raw_split","targets":5},{"name":"adjust_div_time","targets":6},{"name":"adjust_all_split","targets":7}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
  <p>So Catz did pretty poorly in Head to Head. They were faster at Fairbairns, but we downweight that, and Newnham Head, but were in a fast division.</p>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>
